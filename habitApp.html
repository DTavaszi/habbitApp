<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>HabitApp</title>
 
        <link href="css/style.css" rel="stylesheet">
		<link href="css/bootstrap.css" rel="stylesheet">
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css"/>
	<style type="text/css">
	</style>
	</head>
    <body>
<pre id="debug"> </pre>
		<div class="container">
			<div  class="hero-unit">
				<button id="addHabits">Add habit</button>			
			</div>
			
		</div>
		<div id="buttonField" class="button-field"></div>

		<div id="Schedule">
		<div id="Monday" class="day"><header>Monday</header></div>
		<div id="Tuesday" class="day"><header>Tuesday</header></div>
		<div id="Wednesday" class="day"><header>Wednesday</header></div>
		<div id="Thursday" class="day"><header>Thursday</header></div>
		<div id="Friday" class="day"><header>Friday</header></div>
		<div id="Saturday" class="day"><header>Saturday</header></div>
		<div id="Sunday" class="day"><header>Sunday</header></div>
		</div>

		<!--This is the dialog for creating habits-->
		<div id="dialog-form" title="Form a habit">
		  <p class="validateTips">All form fields are required.</p>		  
		  <form>
		  <fieldset>
			<label for="habit">Name your habit:</label>
			<input type="text" name="habit" id="habit" class="text ui-widget-content ui-corner-all" />
			<label for="target"></label>
			<label for="target">Target goal:</label>
			<input type="text" name="target" id="target" class="text ui-widget-content ui-corner-all" />	
			<br/>
			<input type="checkbox" name="chkWeek" id="chkWeek"> Per Week
			<input type="checkbox" name="chkDay" id="chkDay"> Per day
			
		  </fieldset>
		  </form>
		</div>
    </body>	
	
	<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
	<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
	<script type="text/javascript">		
		//DNDHTML5
		var dragSrcEl = null;
		function handleDragOver(e) {
		  if (e.preventDefault) {
			e.preventDefault(); // Necessary. Allows us to drop.
		  }

		  e.dataTransfer.dropEffect = 'move';  // See the section on the DataTransfer object.

		  return false;
		}

		function handleDragEnter(e) {
		  // this / e.target is the current hover target.
			this.classList.add('over');

		}

		function handleDragLeave(e) {
		  this.classList.remove('over');  // this / e.target is previous target element.
		}

		function handleDragEnd(e) {
		  // this/e.target is the source node.
			this.style.opacity = "1.0";
		  [].forEach.call(cols, function (col) {
			col.classList.remove('over');
		  });
		}


		var dragSrcEl = null;
		var dropSrcEl = null;

		function handleDragStart(e) {
		  // Target (this) element is the source node.
		  this.style.opacity = '0.4';

		  dragSrcEl = this;

		  e.dataTransfer.effectAllowed = 'move';
		  e.dataTransfer.setData('text/html', this.innerHTML);
		}

		function handleDrop(e) {
		  // this/e.target is current target element.

		  if (e.stopPropagation) {
			e.stopPropagation(); // Stops some browsers from redirecting.
		  }

		  // Don't do anything if dropping the same column we're dragging.
		  if (dragSrcEl != this) {
			// Set the source column's HTML to the HTML of the column we dropped on.
			
			//alert(this.innerHTML);
			this.innerHTML += "<div class='drag'>" + dragSrcEl.innerHTML + "</div>";
			//dragSrcEl.innerHTML = null;
			dragSrcEl = null;
		  }
		  return false;
		}
		
		//{name : habit.val(), counter : 0, target : target.val(), perWeek : pWeek }
		//{name, target, pDayWeek, currTarget, daysOfWeek, progress}		
		function addHabitToDay(habit, day)
		{
			habit.daysOfWeek.day = 1;
		}
//DNDHTML5
		function createHabit(habit, habitCount, func)
		{			
			var bfield = 'bfield' + habitCount;
			$('#buttonField').append($('<div id=' + bfield + ' class="drag" draggable="true">'));
			
			var habitButton = document.createElement("input");
			habitButton.type = "button";
			habitButton.style.textAlign="justify";
			habitButton.value = habit.name;
			habitButton.style.width="100px";
			habitButton.onclick = func;
			document.getElementById(bfield).appendChild(habitButton);
			
			var plusButton = document.createElement("input");
			plusButton.type = "button";
			plusButton.value = "+";			
			
			document.getElementById(bfield).appendChild(plusButton);
			$('#' + bfield).append($('<br/>'));			
			
			var counterButton = document.createElement("input");
			counterButton.type = "button";
			counterButton.style.textAlign="center";
			counterButton.style.width="100px";
			counterButton.onclick = func;
			document.getElementById(bfield).appendChild(counterButton);
			$('#' + bfield).append($('<p/>'));
			
			plusButton.onclick = function () 
								{ 									
									return (function (button)
										{
											if(habit.currTarget < habit.target)
											{
												habit.currTarget++;
												button.value = habit.currTarget;
											}											
										})(counterButton)							
								};
								
			var hab = document.getElementById(bfield);
			  
			hab.addEventListener('dragstart', handleDragStart, false);
			hab.addEventListener('dragenter', handleDragEnter, false);
			hab.addEventListener('dragover', handleDragOver, false);
			hab.addEventListener('dragleave', handleDragLeave, false);
			hab.addEventListener('drop', handleDrop, false);
			hab.addEventListener('dragend', handleDragEnd, false);			
			}
		
		window.onload = function(){
			var myHabits = [];
			//{name : habit.val(), counter : 0, target : target.val(), perWeek : pWeek }	
			//{name, target, pDayWeek, currTarget, daysOfWeek, progress}
			//daysOfWeek = [day, time]
			//progress = [currTarget, target] //up to 60 cases
			
			//Define form
			document.getElementById('addHabits').onclick = function () { return $( "#dialog-form" ).dialog( "open" ) };
						
			var habit = $( "#habit" ), //Variables for the Create Habit dialog
			  target = $( "#target" ),
			  allFields = $( [] ).add( habit ).add( target ),
			  tips = $( ".validateTips" );
			document.getElementById("chkWeek").checked = true;  
			document.getElementById("chkDay").onclick = function () { 
																		document.getElementById("chkWeek").checked = false;
																		};
			document.getElementById("chkWeek").onclick = function () { 
																		document.getElementById("chkDay").checked = false;
																		};
																		
			$( "#dialog-form" ).dialog({
			  autoOpen: false,
			  height: 400,
			  width: 350,
			  modal: true,
			  buttons: {
				"Create an account": function() {
				
				  var bValid = true;
				  
				  allFields.removeClass( "ui-state-error" );
				  bValid = bValid && checkLength( habit, "habit", 3, 16 );
				  bValid = bValid && checkLength( target, "target", 1, 2 );
				  
				  bValid = bValid && checkRegexp( habit, /^[a-z]([0-9a-z_])+$/i, "Habit may consist of a-z, 0-9, underscores, begin with a letter." );
				 
				  if ( bValid ) {
					var pWeek = document.getElementById("chkWeek").checked;
					
					//{name : habit.val(), counter : 0, target : target.val(), perWeek : pWeek }	
					//{name, currTarget, target, pDayWeek, , daysOfWeek, progress}
				
					//myHabits.push({name : habit.val(), counter : 0, target : target.val(), perWeek : pWeek });	
					myHabits.push({name : habit.val(), currTarget : 0, target : target.val(), pDayWeek : pWeek, daysOfWeek : {Monday : 0,
																															 Tuesday : 0,
																															Wednesday : 0,
																															Thursday : 0,
																															Friday : 0,
																															Saturday : 0,
																															Sunday : 0},
																															progress : void(0)});
																																
					createHabit(myHabits[myHabits.length-1], myHabits.length, null);
					$( this ).dialog( "close" );
				  }
				},
				Cancel: function() {
				  $( this ).dialog( "close" );					
				}
			  },
			  close: function() {
				allFields.val( "" ).removeClass( "ui-state-error" );
			  }
			});	
			
			//Weekly
			var days = document.querySelectorAll('.day');
			[].forEach.call(days, function(day) {
			  day.addEventListener('dragenter', handleDragEnter, false);
			  day.addEventListener('dragover', handleDragOver, false);
			  day.addEventListener('dragleave', handleDragLeave, false);
			  day.addEventListener('drop', handleDrop, false);
			  day.addEventListener('dragend', handleDragEnd, false);
			});
			  

		}		
	
    function updateTips( t ) {
      tips
        .text( t )
        .addClass( "ui-state-highlight" );
      setTimeout(function() {
        tips.removeClass( "ui-state-highlight", 1500 );
      }, 500 );
    } 
    function checkLength( o, n, min, max ) {
      if ( o.val().length > max || o.val().length < min ) {
        o.addClass( "ui-state-error" );
        updateTips( "Length of " + n + " must be between " +
          min + " and " + max + "." );
        return false;
      } else {
        return true;
      }
    } 
    function checkRegexp( o, regexp, n ) {
      if ( !( regexp.test( o.val() ) ) ) {
        o.addClass( "ui-state-error" );
        updateTips( n );
        return false;
      } else {
        return true;
      }
    } 
</script>
</html>